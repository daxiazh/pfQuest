# pfQuest æ•°æ®å¤„ç†å·¥å…·é›†

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ pfQuest æ’ä»¶æ•°æ®å¤„ç†å·¥å…·é›†ï¼ŒåŒ…å«æ•°æ®åˆå¹¶å’Œä»»åŠ¡å¥–åŠ±æŠ“å–åŠŸèƒ½ã€‚

## ğŸ› ï¸ å·¥å…·æ¦‚è§ˆ

### 1. ä»»åŠ¡æ•°æ®åˆå¹¶å·¥å…·
- **æ–‡ä»¶**: `index.js`, `quest-merger.js`, `lua-parser.js`
- **åŠŸèƒ½**: åˆå¹¶åŸºç¡€ä»»åŠ¡æ•°æ®å’Œä¹Œé¾Ÿæœæ•°æ®ï¼Œç”Ÿæˆæœ‰æ•ˆä»»åŠ¡IDåˆ—è¡¨
- **è¾“å‡º**: `output/valid-quest-ids.json`

### 2. ä»»åŠ¡å¥–åŠ±æŠ“å–å·¥å…· (Selenium)
- **æ–‡ä»¶**: `scrape-quest-rewards-selenium.js`, `quest-reward-scraper-selenium.js`
- **åŠŸèƒ½**: ä½¿ç”¨çœŸå®æµè§ˆå™¨æŠ“å–ä»»åŠ¡å¥–åŠ±å’Œç‰©å“ä¿¡æ¯
- **è¾“å‡º**: `output/quest-rewards-selenium.json`

### 3. ä»»åŠ¡å¥–åŠ±æ•°æ®è½¬æ¢å·¥å…· â­ æ–°å¢
- **æ–‡ä»¶**: `convert-quest-rewards-to-lua.js`
- **åŠŸèƒ½**: å°†æŠ“å–çš„JSONæ•°æ®è½¬æ¢ä¸ºpfQuest-turtleå¯ç”¨çš„Luaæ ¼å¼
- **è¾“å‡º**: `pfQuest-turtle/db/quest-rewards-turtle.lua`, `pfQuest-turtle/db/item-props-turtle.lua`

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–
```bash
cd Tools
npm install
```

### åŸºæœ¬ä½¿ç”¨æµç¨‹

#### æ­¥éª¤1: åˆå¹¶ä»»åŠ¡æ•°æ®
```bash
# ç”Ÿæˆæœ‰æ•ˆä»»åŠ¡IDåˆ—è¡¨
npm start
# æˆ–
npm run merge
```

#### æ­¥éª¤2: æŠ“å–ä»»åŠ¡å¥–åŠ±
```bash
# è°ƒè¯•å•ä¸ªä»»åŠ¡ï¼ˆæ¨èé¦–æ¬¡ä½¿ç”¨ï¼‰
npm run scrape-debug

# å¤„ç†å°‘é‡ä»»åŠ¡
npm run scrape-sample

# åå°æ‰¹é‡å¤„ç†
npm run scrape-headless

# å¤„ç†æ‰€æœ‰ä»»åŠ¡ï¼ˆæ—¶é—´è¾ƒé•¿ï¼Œæ”¯æŒå¢é‡å¤„ç†ï¼‰
npm run scrape-all

# åå°å¤„ç†æ‰€æœ‰ä»»åŠ¡ï¼ˆæ¨èï¼‰
npm run scrape-all-headless
```

#### æ­¥éª¤3: è½¬æ¢ä¸ºLuaæ ¼å¼ â­ æ–°å¢
```bash
# è½¬æ¢JSONæ•°æ®ä¸ºpfQuest-turtle Luaæ ¼å¼
npm run convert

# æµ‹è¯•è½¬æ¢ç»“æœ
npm run test-conversion
```

## ğŸ“‹ è¯¦ç»†ä½¿ç”¨è¯´æ˜

### ä»»åŠ¡æ•°æ®åˆå¹¶å·¥å…·

**åŸºæœ¬ç”¨æ³•:**
```bash
node index.js [--full]
```

**åŠŸèƒ½:**
- è§£æ pfQuest åŸºç¡€ä»»åŠ¡æ•°æ®
- åˆå¹¶ä¹Œé¾Ÿæœè‡ªå®šä¹‰æ•°æ®
- åº”ç”¨åˆ é™¤å’Œè¦†ç›–æ“ä½œ
- ç”Ÿæˆç»Ÿä¸€çš„ä»»åŠ¡IDåˆ—è¡¨

**è¾“å‡ºæ–‡ä»¶:**
- `valid-quest-ids.json` - åŸºç¡€ä»»åŠ¡IDåˆ—è¡¨
- `quest-data-detailed.json` - è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯
- `merged-quest-data.json` - å®Œæ•´åˆå¹¶æ•°æ®ï¼ˆä½¿ç”¨ --fullï¼‰

### ä»»åŠ¡å¥–åŠ±æŠ“å–å·¥å…· (æ¨è)

**åŸºæœ¬ç”¨æ³•:**
```bash
node scrape-quest-rewards-selenium.js [é€‰é¡¹]
```

**ä¸»è¦é€‰é¡¹:**
```bash
--debug [ä»»åŠ¡ID]      # è°ƒè¯•æ¨¡å¼ï¼Œæ˜¾ç¤ºæµè§ˆå™¨ï¼ˆé»˜è®¤ï¼š41188ï¼‰
-a, --all            # å¤„ç†æ‰€æœ‰ä»»åŠ¡ï¼ˆè‡ªåŠ¨å¯ç”¨å¢é‡å¤„ç†ï¼‰
-c, --count <æ•°é‡>    # å¤„ç†æŒ‡å®šæ•°é‡çš„ä»»åŠ¡
-q, --quests <åˆ—è¡¨>   # å¤„ç†æŒ‡å®šä»»åŠ¡IDï¼ˆé€—å·åˆ†éš”ï¼‰
--headless           # æ— å¤´æ¨¡å¼ï¼ˆåå°è¿è¡Œï¼‰
--show-browser       # æ˜¾ç¤ºæµè§ˆå™¨çª—å£ï¼ˆé»˜è®¤ï¼‰
-d, --delay <æ¯«ç§’>   # è¯·æ±‚é—´éš”ï¼ˆé»˜è®¤ï¼š3000msï¼‰
-o, --output <è·¯å¾„>  # è¾“å‡ºæ–‡ä»¶è·¯å¾„
```

**âœ¨ å¢é‡å¤„ç†åŠŸèƒ½ (All æ¨¡å¼)**
- ğŸ”„ **è‡ªåŠ¨æ–­ç‚¹ç»­ä¼ **: ç¨‹åºæ„å¤–ä¸­æ–­åé‡æ–°å¯åŠ¨ä¼šä»ä¸Šæ¬¡å¤„ç†çš„ä½ç½®ç»§ç»­
- ğŸ’¾ **è¿›åº¦å®æ—¶ä¿å­˜**: æ¯10ä¸ªä»»åŠ¡è‡ªåŠ¨ä¿å­˜ä¸€æ¬¡å®Œæ•´æ•°æ®
- ğŸ“ **è¿›åº¦æ–‡ä»¶è·Ÿè¸ª**: ç”Ÿæˆ `*-progress.json` æ–‡ä»¶è®°å½•å½“å‰è¿›åº¦
- ğŸ”„ **æ•°æ®å¢é‡åˆå¹¶**: æ–°æ•°æ®ä¼šä¸ç°æœ‰æ•°æ®åˆå¹¶ï¼Œè€Œä¸æ˜¯è¦†ç›–
- â­ï¸ **æ™ºèƒ½è·³è¿‡**: è‡ªåŠ¨è·³è¿‡å·²å¤„ç†çš„ä»»åŠ¡ï¼Œé¿å…é‡å¤å·¥ä½œ

**ä½¿ç”¨ç¤ºä¾‹:**
```bash
# è°ƒè¯•å•ä¸ªä»»åŠ¡
node scrape-quest-rewards-selenium.js --debug

# å¤„ç†æŒ‡å®šä»»åŠ¡
node scrape-quest-rewards-selenium.js -q 41188,41209,50001

# æ— å¤´æ¨¡å¼å¤„ç†50ä¸ªä»»åŠ¡
node scrape-quest-rewards-selenium.js --headless -c 50

# è‡ªå®šä¹‰é—´éš”å’Œè¾“å‡º
node scrape-quest-rewards-selenium.js -d 5000 -o my-rewards.json

# All æ¨¡å¼ï¼ˆæ¨èç”¨äºå¤§è§„æ¨¡å¤„ç†ï¼‰
node scrape-quest-rewards-selenium.js --all --headless
```

### ä»»åŠ¡å¥–åŠ±æ•°æ®è½¬æ¢å·¥å…· â­ æ–°å¢

**åŸºæœ¬ç”¨æ³•:**
```bash
node convert-quest-rewards-to-lua.js
```

**åŠŸèƒ½:**
- è¯»å– `output/quest-rewards-selenium.json` æ–‡ä»¶
- ä½¿ç”¨ WoW å®˜æ–¹ ItemType åˆ†ç±»ç³»ç»Ÿå¯¹ç‰©å“è¿›è¡Œåˆ†ç±»
- è‡ªåŠ¨æ£€æµ‹å¹¶å¤ç”¨ç°æœ‰ pfQuest ç‰©å“åç§°æ•°æ®
- ç”Ÿæˆç´§å‡‘çš„æ•°å­—æ•°ç»„æ ¼å¼ Lua æ–‡ä»¶

**è¾“å‡ºæ–‡ä»¶:**
- `pfQuest-turtle/db/quest-rewards-turtle.lua` - ä»»åŠ¡å¥–åŠ±æ•°æ®
- `pfQuest-turtle/db/item-props-turtle.lua` - ç‰©å“å±æ€§æ•°æ®
- `pfQuest-turtle/db/zhCN/quest-items-turtle.lua` - æ–°å¢ç‰©å“åç§°ï¼ˆå¦‚éœ€è¦ï¼‰

**æ•°æ®æ ¼å¼:**
```lua
-- ä»»åŠ¡å¥–åŠ±: [questId] = {itemId1, itemId2, ...}
[6] = {6076, 60, 3070}

-- ç‰©å“å±æ€§: [itemId] = {quality, class, subclass}
[60] = {1, 4, 2}  -- æ™®é€šå“è´¨ï¼ŒæŠ¤ç”²ç±»ï¼Œçš®ç”²å­ç±»
```

**å“è´¨ç¼–ç **: 0=åŠ£è´¨, 1=æ™®é€š, 2=ä¼˜ç§€, 3=ç²¾è‰¯, 4=å²è¯—, 5=ä¼ è¯´, 6=ç¥å™¨  
**ç±»å‹ç¼–ç **: 0=æ¶ˆè€—å“, 1=å®¹å™¨, 2=æ­¦å™¨, 4=æŠ¤ç”², 7=å•†å“, 9=é…æ–¹, 12=ä»»åŠ¡ç‰©å“, 15=æ‚é¡¹

**ä½¿ç”¨ç¤ºä¾‹:**
```bash
# åŸºæœ¬è½¬æ¢
node convert-quest-rewards-to-lua.js

# å¯ç”¨è°ƒè¯•æ¨¡å¼
DEBUG=1 node convert-quest-rewards-to-lua.js

# æµ‹è¯•è½¬æ¢ç»“æœ
node test-conversion.js
```

## ğŸ”§ ç³»ç»Ÿè¦æ±‚

### åŸºç¡€è¦æ±‚
- **Node.js** 12.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **npm** åŒ…ç®¡ç†å™¨

### Selenium æŠ“å–å·¥å…·é¢å¤–è¦æ±‚
- **Chrome æµè§ˆå™¨** - å¿…é¡»å®‰è£…
- **ChromeDriver** - ä¼šè‡ªåŠ¨ä¸‹è½½ç®¡ç†
- **è¶³å¤Ÿå†…å­˜** - å»ºè®®è‡³å°‘ 4GB RAM

## ğŸ“ è¾“å‡ºæ–‡ä»¶ç»“æ„

### ä»»åŠ¡IDæ–‡ä»¶ (`valid-quest-ids.json`)
```json
{
  "timestamp": "2024-01-01T00:00:00.000Z",
  "validQuestIds": [1, 2, 3, ...],
  "stats": {
    "baseCount": 2847,
    "turtleCount": 245,
    "validCount": 2921,
    "deletedCount": 15,
    "addedCount": 230
  }
}
```

### ä»»åŠ¡å¥–åŠ±æ–‡ä»¶ (`quest-rewards-selenium.json`)
```json
{
  "timestamp": "2024-01-01T00:00:00.000Z",
  "stats": { ... },
  "questRewards": {
    "41188": {
      "questId": 41188,
      "title": "ä»»åŠ¡æ ‡é¢˜",
      "rewardItems": [{"itemId": 25815, "name": "ç‰©å“åç§°", "quantity": 1}],
      "choiceItems": [...],
      "experience": 6600,
      "money": 55000
    }
  },
  "itemDetails": {
    "25815": {
      "itemId": 25815,
      "name": "æ¶é­”å¸ƒé•¿è¢",
      "type": "Armor",
      "subtype": "Cloth",
      "quality": "Uncommon",
      "level": 54,
      "requiredLevel": 49
    }
  }
}
```

## ğŸ¯ NPM è„šæœ¬å¿«æ·æ–¹å¼

| è„šæœ¬ | å‘½ä»¤ | æè¿° |
|------|------|------|
| `npm start` | `node index.js` | æ•°æ®åˆå¹¶å·¥å…· |
| `npm run merge` | `node quest-merger.js` | æ•°æ®åˆå¹¶å·¥å…· |
| `npm run scrape` | é»˜è®¤æŠ“å– | ä½¿ç”¨ Selenium æŠ“å– |
| `npm run scrape-debug` | è°ƒè¯•æ¨¡å¼ | å•ä»»åŠ¡è°ƒè¯• |
| `npm run scrape-sample` | æ ·æœ¬æµ‹è¯• | å¤„ç†5ä¸ªä»»åŠ¡ |
| `npm run scrape-headless` | åå°æ¨¡å¼ | æ— ç•Œé¢å¤„ç†10ä¸ªä»»åŠ¡ |
| `npm run scrape-all` | å…¨é‡å¤„ç† | å¤„ç†æ‰€æœ‰ä»»åŠ¡ï¼Œæ”¯æŒå¢é‡ |
| `npm run scrape-all-headless` | å…¨é‡åå° | åå°å¤„ç†æ‰€æœ‰ä»»åŠ¡ |
| `npm run convert` â­ | `node convert-quest-rewards-to-lua.js` | è½¬æ¢JSONä¸ºLuaæ ¼å¼ |
| `npm run test-conversion` â­ | `node test-conversion.js` | æµ‹è¯•è½¬æ¢ç»“æœ |

## ğŸ› VSCode è°ƒè¯•é…ç½®

é¡¹ç›®åŒ…å«å®Œæ•´çš„ VSCode è°ƒè¯•é…ç½®ï¼š

1. **è°ƒè¯•ä»»åŠ¡æ•°æ®åˆå¹¶å™¨** - è°ƒè¯•æ•°æ®åˆå¹¶è¿‡ç¨‹
2. **è°ƒè¯• Selenium ä»»åŠ¡æŠ“å–å™¨** - è°ƒè¯•ä»»åŠ¡å¥–åŠ±æŠ“å–
3. **è°ƒè¯• Selenium æŒ‡å®šä»»åŠ¡** - è°ƒè¯•ç‰¹å®šä»»åŠ¡ID

ä½¿ç”¨æ–¹æ³•ï¼š
1. åœ¨ VSCode ä¸­æ‰“å¼€ `Tools` ç›®å½•
2. æŒ‰ `F5` æˆ–ç‚¹å‡»"è¿è¡Œå’Œè°ƒè¯•"
3. é€‰æ‹©ç›¸åº”çš„è°ƒè¯•é…ç½®

## âš ï¸ æ³¨æ„äº‹é¡¹

### æ•°æ®åˆå¹¶å·¥å…·
- ç¡®ä¿ pfQuest æ•°æ®æ–‡ä»¶å­˜åœ¨
- åˆå¹¶æ“ä½œæ˜¯è¦†ç›–å¼çš„
- åˆ é™¤æ“ä½œä¸å¯é€†

### ä»»åŠ¡å¥–åŠ±æŠ“å–å·¥å…·
- é¦–æ¬¡è¿è¡Œå¯èƒ½éœ€è¦ä¸‹è½½ ChromeDriver
- å»ºè®®å…ˆä½¿ç”¨ `--debug` æ¨¡å¼æµ‹è¯•
- å¤§æ‰¹é‡æŠ“å–è¯·ä½¿ç”¨ `--headless` æ¨¡å¼
- å¯ä»¥éšæ—¶æŒ‰ `Ctrl+C` ä¸­æ–­å¹¶ä¿å­˜è¿›åº¦
- å»ºè®®è®¾ç½®åˆç†çš„è¯·æ±‚é—´éš”é¿å…æœåŠ¡å™¨é™åˆ¶

### æ€§èƒ½å»ºè®®
- **å°è§„æ¨¡æµ‹è¯•**: å…ˆç”¨ `-c 5` æµ‹è¯•
- **ä¸­ç­‰è§„æ¨¡**: ä½¿ç”¨ `-c 50` 
- **å¤§è§„æ¨¡å¤„ç†**: ä½¿ç”¨ `--headless` æ¨¡å¼
- **è°ƒè¯•é—®é¢˜**: ä½¿ç”¨ `--debug` æ¨¡å¼è§‚å¯Ÿ

## ğŸ”„ å·¥ä½œæµç¨‹å»ºè®®

1. **åˆæ¬¡ä½¿ç”¨**:
   ```bash
   npm install              # å®‰è£…ä¾èµ–
   npm start               # ç”Ÿæˆä»»åŠ¡IDåˆ—è¡¨
   npm run scrape-debug    # æµ‹è¯•å•ä¸ªä»»åŠ¡æŠ“å–
   ```

2. **æ—¥å¸¸ä½¿ç”¨**:
   ```bash
   npm run scrape-sample   # å°è§„æ¨¡æµ‹è¯•
   npm run scrape-headless # æ‰¹é‡å¤„ç†
   ```

3. **å¤§è§„æ¨¡å¤„ç†**:
   ```bash
   npm run scrape-all-headless  # åå°å¤„ç†æ‰€æœ‰ä»»åŠ¡
   # æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œå¯éšæ—¶ä¸­æ–­å’Œæ¢å¤
   ```

4. **æ•…éšœæ’é™¤**:
   ```bash
   npm run scrape-debug    # æŸ¥çœ‹è¯¦ç»†è¿‡ç¨‹
   npm run test-incremental # æµ‹è¯•å¢é‡å¤„ç†åŠŸèƒ½
   # æ£€æŸ¥æµè§ˆå™¨å’Œç½‘ç»œç¯å¢ƒ
   ```

## ğŸ†˜ å¸¸è§é—®é¢˜

**Q: ChromeDriver ä¸‹è½½å¤±è´¥ï¼Ÿ**
A: æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œæˆ–æ‰‹åŠ¨ä¸‹è½½ ChromeDriver å¹¶æ”¾ç½®åœ¨ç³»ç»Ÿ PATH ä¸­

**Q: é¡µé¢åŠ è½½è¶…æ—¶ï¼Ÿ**
A: å¢åŠ  `--delay` å‚æ•°ï¼Œå¦‚ `-d 5000`

**Q: å†…å­˜ä¸è¶³ï¼Ÿ**
A: ä½¿ç”¨ `--headless` æ¨¡å¼ï¼Œæˆ–å‡å°‘å¹¶å‘å¤„ç†æ•°é‡

**Q: æ•°æ®ä¸å®Œæ•´ï¼Ÿ**
A: æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œé‡æ–°è¿è¡ŒæŠ“å–å·¥å…·ä¼šè‡ªåŠ¨è·³è¿‡å·²å¤„ç†çš„é¡¹ç›®

**Q: å¦‚ä½•ä»ä¸­æ–­å¤„ç»§ç»­ï¼Ÿ**
A: Allæ¨¡å¼æ”¯æŒè‡ªåŠ¨æ–­ç‚¹ç»­ä¼ ï¼Œç›´æ¥é‡æ–°è¿è¡Œç›¸åŒå‘½ä»¤å³å¯

**Q: å¦‚ä½•é‡æ–°å¼€å§‹å¤„ç†ï¼Ÿ**
A: åˆ é™¤è¾“å‡ºæ–‡ä»¶å’Œè¿›åº¦æ–‡ä»¶ï¼ˆ*-progress.jsonï¼‰ï¼Œé‡æ–°è¿è¡Œå‘½ä»¤

**Q: è¿›åº¦æ–‡ä»¶çš„ä½œç”¨ï¼Ÿ**
A: è®°å½•æœ€åå¤„ç†çš„ä»»åŠ¡IDï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œé¿å…é‡å¤å¤„ç†

## ğŸ“Š æ€§èƒ½å‚è€ƒ

- **æ•°æ®åˆå¹¶**: é€šå¸¸ < 30ç§’
- **å•ä»»åŠ¡æŠ“å–**: 5-10ç§’ï¼ˆåŒ…å«ç‰©å“è¯¦æƒ…ï¼‰
- **100ä»»åŠ¡æ‰¹é‡**: çº¦30-60åˆ†é’Ÿï¼ˆå–å†³äºç½‘ç»œå’Œé—´éš”è®¾ç½®ï¼‰
- **å†…å­˜ä½¿ç”¨**: æµè§ˆå™¨æ¨¡å¼ ~200MBï¼Œæ— å¤´æ¨¡å¼ ~100MB